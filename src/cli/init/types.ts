/* eslint-disable new-cap */

import * as t from 'runtypes';

import { ProjectType } from '../../utils/manifest';

const INIT_CONFIG_INPUT_FIELDS = {
  destinationDir: t.String,
  templateComplete: t.Boolean,
  templateData: t
    .Record({
      ownerName: t.String,
      repoName: t.String,
    })
    .And(t.Dictionary(t.String, 'string')),
  templateName: t.String,
};

export type InitConfigInput = t.Static<typeof InitConfigInput>;

export const InitConfigInput = t.Record(INIT_CONFIG_INPUT_FIELDS);

export type InitConfig = t.Static<typeof InitConfig>;

/**
 * TODO: migrate from `t.Partial` to `.optional()` once Runtypes 6 is released.
 */
const InitConfig = t
  .Record({
    ...INIT_CONFIG_INPUT_FIELDS,

    templateData: t
      .Record({
        ownerName: t.String,
        repoName: t.String,

        // Derived from ownerName
        orgName: t.String,
        teamName: t.String,

        // Generated by init command
        port: t.String,
      })
      .And(t.Dictionary(t.String, 'string')),
  })
  .And(
    t.Partial({
      entryPoint: t.String,
      type: ProjectType,
    }),
  );
